var $imgs=$(".products .gallery");var $buttons=$(".buttons");var tagged={};$imgs.each(function(){var img=this;var tags=$(this).data("tags");if(tags){tags.split(",").forEach(function(tagName){if(tagged[tagName]==null){tagged[tagName]=[];}tagged[tagName].push(img);});}});$.each(tagged,function(tagName){$("<button/>",{text:tagName,click:function(){$(this).addClass("active").siblings().removeClass("active");$imgs.hide().filter(tagged[tagName]).show();}}).appendTo($buttons);});